<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Event Calendar</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .calendar-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .month-navigation button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            background-color: #f0f0f0;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: 1px solid #e0e0e0;
            font-size: 0.875rem;
        }

        .month-navigation button:hover {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .day-name {
            font-size: 0.75rem;
            font-weight: 500;
            color: #4b5563;
            text-align: center;
            padding: 0.5rem;
        }

        .day {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.875rem;
            position: relative;
            overflow: hidden;
            min-height: 2rem;
        }

        .day:hover {
            background-color: #f0f0f0;
        }

        .day.today {
            background-color: #e0f7fa;
            color: #0694a2;
            font-weight: 600;
        }

        .day.past {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .event-indicator {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: #3b82f6;
            position: absolute;
            bottom: 0.25rem;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Event Form Styles */
        #eventForm {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1), 0 3px 7px -3px rgba(0, 0, 0, 0.04);
            z-index: 100;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #eventForm.show {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        #eventForm label {
            display: block;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }

        #eventForm input,
        #eventForm textarea,
        #eventForm select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            margin-top: 0.3rem;
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
            outline: none;
        }

        #eventForm input:focus,
        #eventForm textarea:focus,
        #eventForm select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        #eventForm textarea {
            resize: vertical;
            min-height: 4rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 2rem;
            gap: 0.75rem;
        }

        .form-actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            border: none;
        }

        .form-actions button.cancel {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .form-actions button.cancel:hover {
            background-color: #d0d0d0;
        }

        .form-actions button.submit {
            background-color: #3b82f6;
            color: white;
        }

        .form-actions button.submit:hover {
            background-color: #2563eb;
        }
        .error-message{
            color:red;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

         /* Event popup styles */
        .event-popup {
            position: fixed;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1), 0 3px 7px -3px rgba(0, 0, 0, 0.04);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .event-popup.show {
            top: 110%;
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%);
        }

        .event-popup-content {
            margin-bottom: 0.75rem;
        }

        .event-popup-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .event-popup-date-time {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .event-popup-mode {
            font-size: 0.875rem;
            color: #1f2937;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event-popup-description {
            font-size: 0.875rem;
            color: #4b5563;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .event-popup-organizer {
            font-size: 0.8rem;
            color: #374151;
            font-weight: 500;
        }

        .event-popup-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 1.25rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.2s ease;
            padding: 0.25rem;
            line-height: 1;
        }

        .event-popup-close:hover {
            color: #1f2937;
        }

        /* Filter styles */
        .filter-dropdown {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            background-color: white;
            color: #333;
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
            margin-right: 1rem;
        }

        .filter-dropdown:hover, .filter-dropdown.active {
            border-color: #3b82f6;
        }

        .filter-dropdown-text {
            margin-right: 0.5rem;
        }

        .filter-dropdown-icon {
            width: 1rem;
            height: 1rem;
            fill: currentColor;
            color: #6b7280;
            transition: transform 0.2s ease;
        }

        .filter-dropdown.active .filter-dropdown-icon {
            transform: rotate(180deg);
        }

        .filter-menu {
            position: absolute;
            top: 100%;
            right: 0;
            left: auto;
            background-color: white;
            border-radius: 0.375rem;
            box-shadow: 0 6px 8px -3px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 60;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-1rem);
            transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
            min-width: 12rem;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
            border: 1px solid #e5e7eb;
            margin-top: 0.25rem;
        }

        .filter-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }


        .filter-menu-item {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: block;
        }

        .filter-menu-item:hover, .filter-menu-item.active {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* Search input styles */
        #eventSearch {
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            width: 100%;
            max-width: 300px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            box-shadow: none;
            outline: none;
            transition: border-color 0.2s ease;
        }

        #eventSearch:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

         /* Sort Dropdown Styles */
        #sortEvents {
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            box-shadow: none;
            outline: none;
            transition: border-color 0.2s ease;
            max-width: 200px;
        }

        #sortEvents:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {  /* Medium screens and below (tablets and phones) */
            .calendar {
                grid-template-columns: repeat(7, minmax(30px, 1fr)); /* Make columns flexible but not too small */
            }
            .day-name {
                font-size: 0.6rem; /* Smaller font on mobile */
                padding: 0.25rem;
            }
            .day {
                font-size: 0.75rem;  /* Smaller font on mobile */
                padding: 0.25rem;
                min-height: 2rem;
            }
            .month-navigation button {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            .event-popup {
                max-width: 95%;  /* Take up most of the screen width on mobile */
                max-height: 90vh; /* Use more of the screen height */
            }
             #eventForm {
                max-width: 95%;
                max-height: 95vh;
            }
        }

        @media (max-width: 640px) { /* Small screens and below (phones) */
            .calendar {
                grid-template-columns: repeat(7, 1fr);  /* Use full width, 1 column */
            }
            .day-name {
                display: none;  /* Hide day names on very small screens */
            }
            .day {
                font-size: 0.7rem;
                padding: 0.2rem;
                min-height: 1.5rem;
            }
             .month-navigation {
                flex-direction: column;
                gap: 1rem;
            }
            #eventSearch, #sortEvents{
                max-width: 100%;
            }
             .filter-container{
                flex-direction: column;
                align-items: flex-start;
            }
            .filter-dropdown{
                margin-bottom: 1rem;
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="calendar-container">
        <div class="month-navigation">
            <button id="prevMonth">❮</button>
            <h2 id="monthYear" class="text-xl font-semibold text-gray-800">Month Year</h2>
            <button id="nextMonth">❯</button>
        </div>

       <div id="eventFilters" class="flex flex-wrap gap-4 mb-4">
            <div id="filterDropdown" class="filter-dropdown">
                <span class="filter-dropdown-text">Filter</span>
                <svg class="filter-dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
            </div>
            <div id="filterMenu" class="filter-menu">
                <div class="filter-menu-item" data-type="All">All Events</div>
                <div class="filter-menu-item" data-type="Online">Online Events</div>
                <div class="filter-menu-item" data-type="Offline">Offline Events</div>
                 <div class="filter-menu-item" data-type="CSE">CSE</div>
                <div class="filter-menu-item" data-type="IT">IT</div>
                <div class="filter-menu-item" data-type="2nd Year">2nd Year</div>
            </div>
        </div>

        <input
            type="text"
            id="eventSearch"
            placeholder="Search events..."
            class="mb-4"
        />

        <select id="sortEvents" class="mb-4">
            <option value="upcoming">Upcoming Soon</option>
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
        </select>

        <div id="calendar" class="calendar">
            </div>
        <div class="upload-button">
             <button id="add-event-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Add Event</button>
        </div>
        <div id="eventPopup" class="event-popup">
            <div class="event-popup-content">
                <h3 id="eventPopupTitle" class="event-popup-title">Event Title</h3>
                <p id="eventPopupDateTime" class="event-popup-date-time"></p>
                <p id="eventPopupMode" class="event-popup-mode"></p>
                <p id="eventPopupDescription" class="event-popup-description"></p>
                <p id="eventPopupOrganizer" class="event-popup-organizer"></p>
            </div>
            <button id="eventPopupClose" class="event-popup-close">&times;</button>
        </div>

         <form id="eventForm" class="hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Add New Event</h2>
            <label for="title">Event Title:</label>
            <input type="text" id="title" name="title" required>
             <div id="title-error" class="error-message"></div>

            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea>
             <div id="description-error" class="error-message"></div>

            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required>
             <div id="date-error" class="error-message"></div>

            <label for="time">Time:</label>
            <input type="time" id="time" name="time" required>
             <div id="time-error" class="error-message"></div>

            <label for="mode">Mode:</label>
            <select id="mode" name="mode">
                <option value="Offline">Offline</option>
                <option value="Online">Online</option>
            </select>
            <div id="mode-error" class="error-message"></div>

            <label for="location">Location/Link:</label>
            <input type="text" id="location" name="location" required>
             <div id="location-error" class="error-message"></div>

            <label for="audience">Target Audience:</label>
             <select id="audience" name="audience">
                <option value="All">All</option>
                <option value="CSE">CSE</option>
                <option value="IT">IT</option>
                <option value="2nd Year">2nd Year</option>
            </select>
             <div id="audience-error" class="error-message"></div>

            <div class="form-actions">
                <button type="button" class="cancel">Cancel</button>
                <button type="submit" class="submit">Add Event</button>
            </div>
        </form>
    </div>

    <script>
        const calendarEl = document.getElementById('calendar');
        const monthYearEl = document.getElementById('monthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const eventPopup = document.getElementById('eventPopup');
        const eventPopupClose = document.getElementById('eventPopupClose');
        const eventPopupTitleEl = document.getElementById('eventPopupTitle');
        const eventPopupDateTimeEl = document.getElementById('eventPopupDateTime');
        const eventPopupModeEl = document.getElementById('eventPopupMode');
        const eventPopupDescriptionEl = document.getElementById('eventPopupDescription');
        const eventPopupOrganizerEl = document.getElementById('eventPopupOrganizer');
        const eventSearchEl = document.getElementById('eventSearch');
        const sortEventsDropdown = document.getElementById('sortEvents');
        const eventFilters = document.getElementById('eventFilters');
        const addEventButton = document.getElementById('add-event-button');
        const eventForm = document.getElementById('eventForm');
        const formCancelButton = eventForm.querySelector('.cancel');
        const formSubmitButton = eventForm.querySelector('.submit');

        let editingEventId = null;
        let events = JSON.parse(localStorage.getItem('events')) || [
             {
                title: "CodeX Hackathon",
                description: "24-hour coding event focusing on real-world problems.",
                date: "2024-04-10T10:00:00",
                organizer: "Coding Club",
                type: "Tech",
                mode: "Offline",
                location: "Auditorium A",
                image: "https://placehold.co/600x300/007BFF/FFFFFF?text=CodeX+Hackathon&font=Montserrat", // Example URL
                uploadedBy: "Dr. Smith"  // Added uploader
            },
            {
                title: "Annual Cultural Fest",
                description: "Dance, drama, music & more!",
                date: "2024-04-15T18:00:00",
                organizer: "Cultural Committee",
                type: "Cultural",
                mode: "Offline",
                location: "Open Ground",
                image: "https://placehold.co/600x300/FFC107/000000?text=Cultural+Fest&font=Montserrat",
                uploadedBy: "Ms. Johnson"
            },
            {
                title: "Tech Symposium 2024",
                description: "Showcasing the latest advancements in technology.",
                date: "2024-05-20T09:00:00",
                organizer: "Computer Science Department",
                type: "Tech",
                mode: "Offline",
                location: "Main Hall",
                image: "https://placehold.co/600x300/28a745/FFFFFF?text=Tech+Symposium&font=Montserrat",
                uploadedBy: "Dr. Smith"
            },
            {
                title: "Spring Sports Meet",
                description: "Inter-college sports competition.",
                date: "2024-05-01T08:00:00",
                organizer: "Sports Council",
                type: "Sports",
                mode: "Offline",
                location: "University Sports Complex",
                image: "https://placehold.co/600x300/DC3545/FFFFFF?text=Sports+Meet&font=Montserrat",
                uploadedBy: "Mr. Brown"
            },
            {
                title: "Webinar on AI",
                description: "Online webinar on Artificial Intelligence.",
                date: "2024-06-10T15:00:00",
                organizer: "AI Research Club",
                type: "Tech",
                mode: "Online",
                location: "https://meet.google.com/xyz",
                image: "https://placehold.co/600x300/17a2b8/FFFFFF?text=AI+Webinar&font=Montserrat",
                uploadedBy: "Dr. Smith"
            },
            {
                title: "Photography Workshop",
                description: "Learn the art of photography.",
                date: "2024-05-25T11:00:00",
                organizer: "Photography Club",
                type: "Cultural",
                mode: "Offline",
                location: "Art Gallery",
                image: "https://placehold.co/600x300/FF6B6B/FFFFFF?text=Photography&font=Montserrat",
                uploadedBy: "Ms. Johnson"
            },
            {
                title: "Code Camp",
                description: "5-day intensive coding workshop.",
                date: "2024-07-01T09:00:00",
                organizer: "Coding Club",
                type: "Tech",
                mode: "Offline",
                location: "Computer Lab 1",
                image: "https://placehold.co/600x300/007bff/FFFFFF?text=Code+Camp&font=Montserrat",
                uploadedBy: "Dr. Smith"
            },
            {
                title: "Music Festival",
                description: "A grand musical event.",
                date: "2024-07-15T19:00:00",
                organizer: "Music Club",
                type: "Cultural",
                mode: "Offline",
                location: "Amphitheater",
                image: "https://placehold.co/600x300/FFD700/000000?text=Music+Fest&font=Montserrat",
                uploadedBy: "Ms. Johnson"
            },
            {
                title: "Debate Competition",
                description: "Inter-department debate competition.",
                date: "2024-06-20T10:00:00",
                organizer: "Debate Society",
                type: "Cultural",
                mode: "Offline",
                location: "Law Auditorium",
                image: "https://placehold.co/600x300/800080/FFFFFF?text=Debate&font=Montserrat",
                uploadedBy: "Mr. Brown"
            },
            {
                title: "Gaming Tournament",
                description: "Online gaming tournament.",
                date: "2024-08-01T16:00:00",
                organizer: "Gaming Club",
                type: "Sports",
                mode: "Online",
                location: "https://discord.gg/gamers",
                image: "https://placehold.co/600x300/28a745/FFFFFF?text=Gaming&font=Montserrat",
                uploadedBy: "Dr. Smith"
            }
        ];

        localStorage.setItem('events', JSON.stringify(events));

        function saveData(){
            localStorage.setItem('events', JSON.stringify(events));
        }

        function loadData(){
            const storedEvents = localStorage.getItem('events');
            if(storedEvents){
                events = JSON.parse(storedEvents);
            }
        }

        loadData();

        let currentDate = new Date();
        let userRole = 'teacher'; // Or 'student'.  This would come from your auth system.

        let editingeventid = null;

        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];



        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            calendarEl.innerHTML = '';
            monthYearEl.textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            dayNames.forEach(dayName => {
                const dayNameEl = document.createElement('div');
                dayNameEl.className = 'day-name';
                dayNameEl.textContent = dayName;
                calendarEl.appendChild(dayNameEl);
            });

            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                calendarEl.appendChild(emptyCell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = `day ${isPast(year, month, day) ? 'past' : ''} ${isToday(year, month, day) ? 'today' : ''}`;
                dayEl.textContent = day;
                const fullDate = new Date(year, month, day).toISOString().split('T')[0];

                const eventsForDay = getEventsForDay(fullDate);
                if (eventsForDay.length > 0) {
                    dayEl.classList.add('event-day');
                    dayEl.addEventListener('click', () => showEventsForDay(fullDate));
                    dayEl.innerHTML += `<div class="event-indicator"></div>`;
                }
                 if (userRole === 'teacher') {
                    dayEl.addEventListener('click', () => handleDayClick(fullDate));
                }
                calendarEl.appendChild(dayEl);
            }
        }

        function isToday(year, month, day) {
            const today = new Date();
            return today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        }

        function isPast(year, month, day) {
            const today = new Date();
            const dateToCheck = new Date(year, month, day);
            return dateToCheck < today;
        }

        function getEventsForDay(date) {
            return events.filter(event => event.date.startsWith(date));
        }

        function showEventsForDay(date) {
            const dayEvents = getEventsForDay(date);
             eventPopupTitleEl.textContent = `Events for ${formatDate(date)}`;
             let eventContent = '';
            if(dayEvents.length === 0){
                 eventContent = `<p>No events for this day.</p>`;
            }
            else{
                dayEvents.forEach(event => {
                const modeClass = event.mode === 'Online' ? 'online' : 'offline';
                eventContent += `
                    <div class="event-popup-content">
                        <h3 class="event-popup-title">${event.title}</h3>
                        <p class="event-popup-date-time">Date: ${formatDate(event.date)} | Time: ${formatTime(event.date)}</p>
                        <p class="event-popup-mode ${modeClass}">${event.mode} | ${event.mode === 'Online' ? 'Join Online' : 'Location: ' + event.location}</p>
                        <p class="event-popup-description">${event.description}</p>
                        <p class="event-organizer">Organized by: ${event.organizer}</p>
                    </div>
                `;
            });
            }
            eventPopupContent.innerHTML = eventContent;
            eventPopup.classList.add('show');
        }

        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        eventPopupClose.addEventListener('click', () => {
            eventPopup.classList.remove('show');
            editingeventid = null;
        });

        document.addEventListener('click', (event) => {
            if (event.target === eventPopup) {
                eventPopup.classList.remove('show');
            }
             if (!event.target.closest('.filter-dropdown') && !event.target.closest('.filter-menu')) {
                filterMenu.classList.remove('show');
            }
        });



        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }



        eventSearchEl.addEventListener('input', () => {
            const searchTerm = eventSearchEl.value.toLowerCase();
            const filteredEvents = filterEvents(searchTerm);
            renderCalendar();
             const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
           for (let i = 0; i < firstDay + daysInMonth; i++) {
                const dayElement = calendarEl.children[i + 7];
                if (!dayElement) continue;
                const fullDate = new Date(year, month, i - firstDay + 1).toISOString().split('T')[0];
                const eventsForDay = getEventsForDay(fullDate);
                 if (eventsForDay.length > 0) {
                      dayElement.classList.add('event-day');
                 }
                 else{
                    dayElement.classList.remove('event-day');
                 }
            }
        });

        sortEventsDropdown.addEventListener('change', () => {
            const sortBy = sortEventsDropdown.value;
            let sortedEvents = [...events];
             switch (sortBy) {
                case 'newest':
                    sortedEvents.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'oldest':
                    sortedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'upcoming':
                    sortedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                default:
                    break;
            }
            events = sortedEvents;
            renderCalendar();
             const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
           for (let i = 0; i < firstDay + daysInMonth; i++) {
                const dayElement = calendarEl.children[i + 7];
                if (!dayElement) continue;
                 const fullDate = new Date(year, month, i - firstDay + 1).toISOString().split('T')[0];
                const eventsForDay = getEventsForDay(fullDate);
                 if (eventsForDay.length > 0) {
                      dayElement.classList.add('event-day');
                 }
                 else{
                    dayElement.classList.remove('event-day');
                 }
            }

        });

        eventFilters.addEventListener('click', (event) => {
            const filterType = event.target.dataset.type;
            if (!filterType) return;

            if (filterType === 'All') {
                activeFilters.clear();
                activeFilters.add('All');
            } else {
                activeFilters.delete('All');
                if (activeFilters.has(filterType)) {
                    activeFilters.delete(filterType);
                } else {
                    activeFilters.add(filterType);
                }
                if (activeFilters.size === 0) {
                    activeFilters.add('All');
                }
            }

            // Update UI for active filters
            filterMenuItems.forEach(menuItem => {
                menuItem.classList.toggle('active', activeFilters.has('All') || activeFilters.has(menuItem.dataset.type));
            });
             const searchTerm = eventSearchEl.value.trim();
            const filteredEvents = filterEvents(searchTerm);
            const sortedEvents = sortEvents(filteredEvents, sortEventsDropdown.value);
            displayEvents(sortedEvents);
            renderCalendar();
             const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
           for (let i = 0; i < firstDay + daysInMonth; i++) {
                const dayElement = calendarEl.children[i + 7];
                if (!dayElement) continue;
                 const fullDate = new Date(year, month, i - firstDay + 1).toISOString().split('T')[0];
                const eventsForDay = getEventsForDay(fullDate);
                 if (eventsForDay.length > 0) {
                      dayElement.classList.add('event-day');
                 }
                 else{
                    dayElement.classList.remove('event-day');
                 }
            }
            filterMenu.classList.remove('show');
        });

        function handleDayClick(date) {
            editingEventId = null;
            eventForm.reset();
            document.getElementById('date').value = date;
            document.getElementById('time').value = '12:00';
            showForm();
        }



        addEventButton.addEventListener('click', () => {
            editingEventId = null;
            eventForm.reset();
             const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('time').value = '12:00';
            showForm();
        });

        formCancelButton.addEventListener('click', () => {
            eventForm.classList.remove('show');
            editingEventId = null;
        });

        function validateForm() {
            let isValid = true;
            const titleInput = document.getElementById('title');
            const descriptionInput = document.getElementById('description');
            const dateInput = document.getElementById('date');
            const timeInput = document.getElementById('time');
            const modeInput = document.getElementById('mode');
            const locationInput = document.getElementById('location');
            const audienceInput = document.getElementById('audience');

            const titleError = document.getElementById('title-error');
            const descriptionError = document.getElementById('description-error');
            const dateError = document.getElementById('date-error');
            const timeError = document.getElementById('time-error');
            const modeError = document.getElementById('mode-error');
            const locationError = document.getElementById('location-error');
             const audienceError = document.getElementById('audience-error');


            titleError.textContent = '';
            descriptionError.textContent = '';
            dateError.textContent = '';
            timeError.textContent = '';
            modeError.textContent = '';
            locationError.textContent = '';
            audienceError.textContent = '';



            if (!titleInput.value.trim()) {
                titleError.textContent = 'Title is required';
                isValid = false;
            }
             if (!descriptionInput.value.trim()) {
                descriptionError.textContent = 'Description is required';
                isValid = false;
            }

            if (!dateInput.value) {
                dateError.textContent = 'Date is required';
                isValid = false;
            }
             if (!timeInput.value) {
                timeError.textContent = 'Time is required';
                isValid = false;
            }
             if (!modeInput.value) {
                modeError.textContent = 'Mode is required';
                isValid = false;
            }
              if (!locationInput.value.trim()) {
                locationError.textContent = 'Location is required';
                isValid = false;
            }
             if (!audienceInput.value) {
                audienceError.textContent = 'Audience is required';
                isValid = false;
            }

            return isValid;
        }

        formSubmitButton.addEventListener('click', (event) => {
            event.preventDefault();

            if (!validateForm()) {
                return;
            }

            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const mode = document.getElementById('mode').value;
            const location = document.getElementById('location').value.trim();
             const audience = document.getElementById('audience').value;


            const eventDateTime = date + 'T' + time;

             if (editingEventId) {
                // Update existing event
                const eventIndex = events.findIndex(e => e.id === editingEventId);
                if (eventIndex !== -1) {
                    events[eventIndex] = {
                        ...events[eventIndex],
                        title,
                        description,
                        date: eventDateTime,
                        mode,
                        location,
                        organizer: 'Teacher',
                        type: 'General',
                        audience
                    };
                }
            } else {
                // Add new event
                const newEvent = {
                    id: Date.now(),
                    title,
                    description,
                    date: eventDateTime,
                    mode,
                    location,
                    organizer: 'Teacher',
                    type: 'General',
                    audience
                };
                events.push(newEvent);
            }
            saveData();
            renderCalendar();
            eventForm.classList.remove('show');
            editingEventId = null;
        });



        function showForm() {
            eventForm.classList.add('show');
        }

        function editEvent(eventId) {
            const eventToEdit = events.find(e => e.id === eventId);
            if (!eventToEdit) return;

            editingEventId = eventId;
            document.getElementById('title').value = eventToEdit.title;
            document.getElementById('description').value = eventToEdit.description;
            document.getElementById('date').value = eventToEdit.date.split('T')[0];
            document.getElementById('time').value = eventToEdit.date.split('T')[1];
            document.getElementById('mode').value = eventToEdit.mode;
            document.getElementById('location').value = eventToEdit.location;
            document.getElementById('audience').value = eventToEdit.audience;


            showForm();
        }


        // Initial render
        renderCalendar();
    </script>
</body>
</html>
